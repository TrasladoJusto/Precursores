<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Administrativo - Escuela de Precursores</title>
    <link rel="icon" href="data:,">
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="admin-body">
    
    <!-- Login Screen -->
    <div id="loginScreen" class="login-wrapper">
        <div class="login-box">
            <div class="login-header">
                <div class="login-icon">üîê</div>
                <h1>Panel Administrativo</h1>
                <p>Escuela del Servicio de Precursor</p>
            </div>
            
            <form id="loginForm" class="login-form">
                <div class="form-field">
                    <label>Usuario</label>
                    <input type="text" id="username" required autocomplete="username">
                </div>
                
                <div class="form-field">
                    <label>Contrase√±a</label>
                    <input type="password" id="password" required autocomplete="current-password">
                </div>
                
                <button type="submit" class="login-button">
                    <span>Acceder al Sistema</span>
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <path d="M4 10H16M16 10L12 6M16 10L12 14" stroke="currentColor" stroke-width="2"/>
                    </svg>
                </button>
            </form>

            <a href="index.html" class="back-link">‚Üê Volver al formulario</a>
        </div>
    </div>

    <div id="adminPanel" class="admin-dashboard hidden">
        <!-- Sidebar -->
        <aside class="admin-sidebar">
            <div class="sidebar-header">
                <h2>Panel Admin</h2>
                <div id="currentAdminUser" style="font-size:0.9rem;color:var(--text-medium);margin-top:6px;"></div>
            </div>
            
            <nav class="sidebar-nav">
                <button class="nav-item active" onclick="showView('dashboard')" id="navDashboard">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <path d="M3 4C3 3.44772 3.44772 3 4 3H7C7.55228 3 8 3.44772 8 4V7C8 7.55228 7.55228 8 7 8H4C3.44772 8 3 7.55228 3 7V4Z" stroke="currentColor" stroke-width="2"/>
                        <path d="M12 4C12 3.44772 12.4477 3 13 3H16C16.5523 3 17 3.44772 17 4V7C17 7.55228 16.5523 8 16 8H13C12.4477 8 12 7.55228 12 7V4Z" stroke="currentColor" stroke-width="2"/>
                        <path d="M3 13C3 12.4477 3.44772 12 4 12H7C7.55228 12 8 12.4477 8 13V16C8 16.5523 7.55228 17 7 17H4C3.44772 17 3 16.5523 3 16V13Z" stroke="currentColor" stroke-width="2"/>
                        <path d="M12 13C12 12.4477 12.4477 12 13 12H16C16.5523 12 17 12.4477 17 13V16C17 16.5523 16.5523 17 16 17H13C12.4477 17 12 16.5523 12 16V13Z" stroke="currentColor" stroke-width="2"/>
                    </svg>
                    <span>Inicio</span>
                </button>

                <button class="nav-item" onclick="showView('submissions')" id="navSubmissions">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <path d="M7 9L10 12L17 5M3 9L6 12L3 9Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>Ver Registros</span>
                    <span class="nav-badge" id="submissionCount">0</span>
                </button>

                <button class="nav-item" onclick="showView('formBuilder')" id="navFormBuilder">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <path d="M11 5H17M11 9H17M11 13H17M3 5H7M3 9H7M3 13H7" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                    <span>Editar Formulario</span>
                </button>

                <button class="nav-item" onclick="showView('export')" id="navExport">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <path d="M10 14L10 4M10 14L7 11M10 14L13 11M4 17H16" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>Exportar Datos</span>
                </button>

                <button class="nav-item" onclick="showView('settings')" id="navSettings">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                        <path d="M12 15.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 1 1-4 0v-.09a1.65 1.65 0 0 0-1-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06A2 2 0 1 1 2.27 16.9l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 1 1 0-4h.09a1.65 1.65 0 0 0 1.51-1 1.65 1.65 0 0 0-.33-1.82l-.06-.06A2 2 0 1 1 6.1 2.27l.06.06a1.65 1.65 0 0 0 1.82.33h.09A1.65 1.65 0 0 0 9.5 2.27V2a2 2 0 1 1 4 0v.27c.3.08.58.21.83.38h.09a1.65 1.65 0 0 0 1.82-.33l.06-.06A2 2 0 1 1 21.73 7.1l-.06.06a1.65 1.65 0 0 0-.33 1.82v.09c.17.25.3.53.38.83H22a2 2 0 1 1 0 4h-.27c-.08.3-.21.58-.38.83z" stroke="currentColor" stroke-width="0" fill="currentColor" opacity="0.08"/>
                    </svg>
                    <span>Configuraci√≥n</span>
                </button>

                <button class="nav-item logout" onclick="logout()">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <path d="M13 4L17 8M17 8L13 12M17 8H7M7 16H4C3.44772 16 3 15.5523 3 15V5C3 4.44772 3.44772 4 4 4H7" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                    <span>Cerrar Sesi√≥n</span>
                </button>
            </nav>
        </aside>

        
        <main class="admin-main">
            <!-- Dashboard View -->
            <div id="dashboardView" class="admin-view">
                <div class="view-header">
                    <h1>Inicio</h1>
                    <p>Vista general del sistema</p>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">üìù</div>
                        <div class="stat-info">
                            <div class="stat-value" id="totalSubmissions">0</div>
                            <div class="stat-label">Total Registros</div>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon">
                            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <circle cx="12" cy="12" r="10" fill="#4CAF50" />
                                <path d="M9 12.5l1.8 1.8L15 11" stroke="#fff" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" fill="none" />
                            </svg>
                        </div>
                        <div class="stat-info">
                            <div class="stat-value" id="confirmados">0</div>
                            <div class="stat-label">Confirmados</div>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon">
                            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M3 11L12 3l9 8" fill="#6B2D5C" />
                                <path d="M5 11v8h6v-6h2v6h6v-8" fill="#8B4A7C" />
                            </svg>
                        </div>
                        <div class="stat-info">
                            <div class="stat-value" id="alojamiento">0</div>
                            <div class="stat-label">Solicitan Alojamiento</div>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon">
                            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <rect x="3" y="5" width="18" height="16" rx="2" fill="#E86C5F" />
                                <path d="M16 3v4M8 3v4" stroke="#fff" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                        <div class="stat-info">
                            <div class="stat-value" id="hoy">0</div>
                            <div class="stat-label">Registros Hoy</div>
                        </div>
                    </div>
                </div>

                <div class="recent-section">
                    <h2>Registros Recientes</h2>
                    <div id="recentSubmissions" class="recent-list"></div>
                </div>
            </div>

            <!-- Submissions View -->
            <div id="submissionsView" class="admin-view hidden">
                <div class="view-header">
                    <h1>Registros de Precursores</h1>
                    <div class="header-actions">
                        <div class="search-box">
                            <input type="text" id="searchInput" placeholder="Buscar por nombre, email o congregaci√≥n..." class="search-input">
                        </div>
                        <div class="filter-box">
                            <select id="filterCongregacion" class="filter-select">
                                <option value="all">Todas las congregaciones</option>
                            </select>
                        </div>
                        <div class="filter-box">
                            <select id="filterAsistencia" class="filter-select" onchange="handleFilter()">
                                <option value="all">Asistencia (Todos)</option>
                                <option value="si">Confirmados</option>
                                <option value="no">No asistir√°n</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div id="submissionsList" class="submissions-table"></div>
            </div>

            <!-- Form Builder View -->
            <div id="formBuilderView" class="admin-view hidden">
                <div class="view-header">
                    <h1>Constructor de Formulario</h1>
                    <p>Edita campos, opciones y estructura del formulario</p>
                </div>

                <div class="builder-container">
                    <div class="builder-section">
                        <h3>Contenido del Sitio</h3>
                        <div style="display:grid; gap:0.75rem; max-width:720px;">
                            <input id="siteHeroTitle" placeholder="T√≠tulo principal (hero)" class="field-input">
                            <input id="siteHeroSubtitle" placeholder="Subt√≠tulo (hero)" class="field-input">
                            <div style="display:flex; gap:0.5rem;">
                                <button class="save-button" onclick="saveSiteContent()">Guardar Contenido</button>
                                <button class="secondary-button" onclick="resetSiteContent()">Restaurar Predeterminado</button>
                            </div>
                        </div>
                    </div>
                    <div class="builder-section">
                        <h3>Opciones de Congregaci√≥n</h3>
                        <div id="congregacionOptions" class="options-list"></div>
                        <button onclick="addCongregacionOption()" class="add-button">+ Agregar Congregaci√≥n</button>
                    </div>

                    <div class="builder-actions">
                        <button onclick="saveFormConfig()" class="save-button">Guardar Cambios</button>
                        <button onclick="resetFormConfig()" class="secondary-button">Restaurar Predeterminado</button>
                    </div>
                </div>
            </div>

            <!-- Export View -->
            <div id="exportView" class="admin-view hidden">
                <div class="view-header">
                    <h1>Exportar Datos</h1>
                    <p>Descarga los registros en formato Excel estructurado</p>
                </div>

                <div class="export-grid">
                    <div class="export-card" onclick="downloadExcel()" style="grid-column: 1 / -1; max-width: 400px; margin: 0 auto;">
                        <div class="export-icon">üìä</div>
                        <h3>Reporte Excel</h3>
                        <p>Archivo .xls con todos los datos ordenados y tablas de resumen</p>
                        <button class="export-btn">Descargar Reporte</button>
                    </div>
                </div>
            </div>
                
                    <!-- Settings View -->
                    <div id="settingsView" class="admin-view hidden">
                        <div class="view-header">
                            <h1>Configuraci√≥n Avanzada</h1>
                            <p>Control total: credenciales, base de datos, import/export y opciones del sitio</p>
                        </div>

                        <div class="builder-container">


                            <div class="builder-section">
                                <h3>Apariencia</h3>
                                <div style="display:grid; gap:0.75rem; max-width:420px;">
                                    <label style="font-weight:600;">Color principal</label>
                                    <input id="sitePrimaryColor" type="color" value="#6B2D5C" class="field-input" style="padding:0.4rem; height:40px;">
                                    <label style="font-weight:600;">Altura del Hero</label>
                                    <select id="siteHeroHeight" class="field-input" style="max-width:240px;">
                                        <option value="50">50vh</option>
                                        <option value="60" selected>60vh</option>
                                        <option value="75">75vh</option>
                                        <option value="90">90vh</option>
                                    </select>
                                    <div style="display:flex; gap:0.5rem;">
                                        <button class="save-button" onclick="saveAppearance()">Aplicar Apariencia</button>
                                        <button class="secondary-button" onclick="resetAppearance()">Restaurar</button>
                                    </div>
                                </div>
                            </div>

                            <div class="builder-section">
                                <h3>Credenciales Administrador</h3>
                                <div style="display: grid; gap: 1rem; max-width: 560px;">
                                    <input id="currentAdminPass" placeholder="Contrase√±a actual" type="password" class="field-input">
                                    <input id="newAdminUser" placeholder="Nuevo usuario" class="field-input">
                                    <input id="newAdminPass" placeholder="Nueva contrase√±a" type="password" class="field-input">
                                    <input id="confirmAdminPass" placeholder="Confirmar nueva contrase√±a" type="password" class="field-input">
                                    <div style="display:flex; gap:0.5rem;">
                                        <button class="save-button" onclick="updateAdminCredentials()">Actualizar Credenciales</button>
                                        <button class="secondary-button" onclick="resetAdminCredentials()">Restaurar a predeterminado</button>
                                    </div>
                                </div>
                            </div>

                            <div class="builder-section">
                                <h3>Gesti√≥n de Registros</h3>
                                <div style="display:flex; gap:0.75rem; flex-wrap:wrap;">
                                    <button class="save-button" onclick="exportAllBackup()">Exportar Excel (Backup)</button>
                                    <button class="secondary-button" onclick="clearAllSubmissions()" style="background:var(--error); color:white; border:none;">Borrar Todos los Registros</button>
                                    <label class="secondary-button" style="cursor:pointer;">
                                        Importar JSON
                                        <input id="importInput" type="file" accept="application/json" style="display:none" onchange="importSubmissions(event)">
                                    </label>
                                </div>
                                <p style="color:var(--text-medium); margin-top:0.5rem;">Se recomienda exportar en Excel antes de borrar.</p>
                            </div>

                            <div class="builder-section">
                                <h3>Campos de Exportaci√≥n</h3>
                                <p style="color:var(--text-medium);">Seleccione los campos que desea incluir al exportar en Excel.</p>
                                <div id="exportFieldsContainer" style="display:grid; grid-template-columns: repeat(2, minmax(0,1fr)); gap:0.5rem; margin-top:0.75rem; max-width:720px;">
                                    <!-- Checkboxes renderizados por JS -->
                                </div>
                                <div style="display:flex; gap:0.5rem; margin-top:0.75rem;">
                                    <button class="save-button" onclick="selectAllExportFields(true)">Seleccionar todos</button>
                                    <button class="secondary-button" onclick="selectAllExportFields(false)">Deseleccionar todos</button>
                                    <button class="save-button" onclick="saveExportFields()">Guardar selecci√≥n</button>
                                    <button class="secondary-button" onclick="resetExportFields()">Restaurar predeterminado</button>
                                </div>
                            </div>

                            <div class="builder-section">
                                <h3>Opciones del Sitio</h3>
                                <div style="display:flex; gap:1rem; align-items:center;">
                                    <label style="font-weight:600;">Permitir nuevos registros</label>
                                    <input type="checkbox" id="toggleSubmissions" onchange="toggleSubmissionsEnabled()">
                                </div>
                            </div>

                            <div class="builder-section">
                                <h3>Registro de Acciones</h3>
                                <div style="display:flex; gap:0.5rem; margin-bottom:0.75rem;">
                                    <button class="save-button" onclick="downloadActionLog()">Exportar Log</button>
                                    <button class="secondary-button" onclick="clearActionLog()">Limpiar Log</button>
                                </div>
                                <div id="actionLog" style="max-height:220px; overflow:auto; background:var(--bg-white); padding:1rem; border-radius:8px; border:1px solid #eee;"></div>
                            </div>
                        </div>
                    </div>
                </main>
            </div>

    <!-- Modal de Detalle -->
    <div id="detailModal" class="modal hidden">
        <div class="modal-backdrop" onclick="closeModal()"></div>
        <div class="modal-container">
            <button class="modal-close" onclick="closeModal()">‚úï</button>
            <div id="modalContent" class="modal-content"></div>
        </div>
    </div>

    <!-- Modal de Edici√≥n -->
    <div id="editModal" class="modal hidden">
        <div class="modal-backdrop" onclick="closeEditModal()"></div>
        <div class="modal-container">
            <button class="modal-close" onclick="closeEditModal()">‚úï</button>
            <div id="editModalContent" class="modal-content"></div>
        </div>
    </div>

    <script src="form-data.js"></script>
    <script src="admin.js"></script>
</body>
</html>
